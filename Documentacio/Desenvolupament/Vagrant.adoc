=== Vagrant Configuració 

Farem ser la següent configuració perla nostra màquina amb Vagrant.

==== Configuració del Vagrant File

[source,ruby]
----

# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
  config.vm.box = "debian/bullseye64"
  config.vm.hostname = "javamariadb"
  config.vm.define "javamariadb"
  config.vm.network "private_network", ip: "172.16.0.100"
  config.vm.provision "shell", path: "bootstrap.sh"
  config.vm.provider "virtualbox" do |vb|
	vb.name = "Marketplace_grup5" 
    vb.memory = "512"
    vb.cpus = 1
  end
end

----



==== Script bash

[source, shell]
----
#!/bin/sh

apt-get update
# apt-get upgrade -y
apt-get install -y mariadb-server mariadb-client

# Crear la base de dades


# Configuració de MariaDB:
# - Permet connexions des de qualsevol host
# - Activa GROUP BY estricte
# - Permet || com a CONCAT (PIPES_AS_CONCAT)
# - No permet " com a delimitador de cadenes, només ' (ANSI_QUOTES)
echo *** Configura MariaDB ***
cp /vagrant/50-server.cnf /etc/mysql/mariadb.conf.d

# Crea l'usuari admin amb accés remot
echo *** Crea usuari ***
mysql << EOF
CREATE OR REPLACE USER admin@'%' IDENTIFIED BY '1234';
GRANT ALL ON *.* TO admin@'%';
EOF

systemctl restart mariadb

----

<1> Substituirem l'arxiu de configuració de Mariadb de connexions, per poder connectar-nos a la base de dades de la màquina virtual.

<2> Script de sql, on farem tota la configuració de la base de dades:
** Creació de l'usuari que farem servir.
** Creació de la base dades.
** Inserts inicials a la base de dades.

==== Configuració Mariadb per les connexions

[source, bash]

----
#
# These groups are read by MariaDB server.
# Use it for options that only the server (but not clients) should see

# this is read by the standalone daemon and embedded servers
[server]

# this is only for the mysqld standalone daemon
[mysqld]

#
# * Basic Settings
#

user                    = mysql
pid-file                = /run/mysqld/mysqld.pid
basedir                 = /usr
datadir                 = /var/lib/mysql
tmpdir                  = /tmp
lc-messages-dir         = /usr/share/mysql
lc-messages             = en_US
skip-external-locking

# Broken reverse DNS slows down connections considerably and name resolve is
# safe to skip if there are no "host by domain name" access grants
#skip-name-resolve

# Instead of skip-networking the default is now to listen only on
# localhost which is more compatible and is not less secure.
bind-address            = 0.0.0.0 <1>
----

<1> Donarem permisos perquè qualsevol pugui accedir.


==== Script sql

[source, sql]

----




----

